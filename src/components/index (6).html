<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte Semanal</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Configuración de Tailwind (Opcional) -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'inter': ['Inter', 'sans-serif']
          }
        }
      }
    }
  </script>

  <!-- Vue 3 via CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Chart.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Estilos BACKGROUND-->
  <style type="text/tailwindcss">
    :root {
      --primary-bg: #ffffff;
      --card-bg: #0A1F4D;
      --accent-blue: #429AEE;
      --border-color: #1E3A7B;
    }

    @layer base {
      html, body {
        @apply bg-[#ffffff] text-white font-inter leading-tight;
      }
    }

    @layer components {

      .title-gradient {
      @apply text-4xl font-bold mb-6 text-transparent bg-clip-text bg-[#3686FF] tracking-wide;
      }
      .metric-card {
        @apply relative rounded-xl p-4 border-l-4 border-l-[#356ACC]
               bg-[#ffffff]/90 shadow-md
               transition-all duration-300 hover:shadow-xl;
      }

      .gradient-text {
        @apply text-black;
      }

      .section-title {
        @apply text-[24px] font-inter gradient-text mb-3;
      }

      .section-description {
        @apply text-sm text-black;
      }
    }

    /* Estilos base para tablas */
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }
    th, td {
      @apply border border-[#356ACC]/40 p-2 text-sm text-black;
    }
    th {
      @apply bg-[#3686FF] font-semibold text-white;
    }

    /* Contenedor de gráficos */
    .chart-container {
      @apply w-full h-48 relative mt-2;
    }
    canvas {
      @apply w-full h-full;
    }
  </style>
</head>
<body>
  <div id="app" class="max-w-6xl mx-auto px-3 py-5">
    <!-- Título de la página -->
    <h1 class="title-gradient">
      Reporte Semanal
    </h1>

    <!-- Diseño en cuadrícula para las secciones -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">

      <!-- Temas Relevantes -->
      <div class="metric-card">
        <h2 class="section-title">Temas Relevantes</h2>
        <p class="section-description">
          Identificación de los temas más discutidos en correos a lo largo de la semana.
        </p>
        <table>
          <tr>
            <th>Tema</th>
            <th>Menciones</th>
          </tr>
          <tr v-for="(topic, idx) in hotTopics" :key="'topic-'+idx">
            <td>{{ topic.Topic }}</td>
            <td>{{ topic.Mentions }}</td>
          </tr>
        </table>
      </div>

      <!-- Distribución de Correos -->
      <div class="metric-card">
        <h2 class="section-title">Distribución de Correos</h2>
        <p class="section-description">
          Análisis de la distribución de correos por tipo y por usuario.
        </p>
        
        <!-- Distribución Global -->
        <h3 class="text-lg font-medium text-[#3686FF] mt-4 mb-2">
          Distribución Global
        </h3>
        <div class="chart-container h-48">
          <canvas id="servicingDistributionUserDonut"></canvas>
        </div>

        <!-- Distribución por Cuenta -->
        <h3 class="text-lg font-medium text-[#3686FF] mt-6 mb-2">
          Distribución Por Usuario
        </h3>
        <div class="chart-container h-48">
          <canvas id="servicingDistributionUserBar"></canvas>
        </div>
      </div>

      <!-- ¿Se está vendiendo NDC? -->
      <div class="metric-card xl:col-span-2">
        <h2 class="section-title">¿Se está vendiendo NDC?</h2>
        <p class="section-description">
          Porcentaje del total de ventas de cada miembro del equipo, indicando en cuántas se ha vendido NDC y en cuántas no.
        </p>
        <div class="chart-container">
          <canvas id="handlingTimeTeamChart"></canvas>
        </div>
      </div>

      <!-- ¿Se está vendiendo Cabina Premium Economy? -->
      <div class="metric-card xl:col-span-2">
        <h2 class="section-title">¿Se está vendiendo Cabina Premium Economy?</h2>
        <p class="section-description">
          Porcentaje del total de ventas de cada miembro del equipo, indicando en cuántas se ha vendido Cabina Premium Economy y en cuántas no.
        </p>
        <div class="chart-container">
          <canvas id="handlingTimeAccountChart"></canvas>
        </div>
      </div>

      <!-- ¿Se está vendiendo Corporate Bundle? -->
      <div class="metric-card xl:col-span-2">
        <h2 class="section-title">¿Se está vendiendo Corporate Bundle?</h2>
        <p class="section-description">
          Porcentaje del total de ventas de cada miembro del equipo, indicando en cuántas se ha vendido Corporate Bundle y en cuántas no.
        </p>
        <div class="chart-container">
          <canvas id="corporateBundleChart"></canvas> 
        </div>
      </div>


      <!-- Actividad del Equipo (Reuniones + Correos) -->
      <div class="metric-card xl:col-span-2">
        <h2 class="section-title">Actividad del Equipo</h2>
        <p class="section-description">
          Reuniones y Correos: Gráfico de barras que muestra el número de interacciones por integrante.
        </p>
        <div class="chart-container">
          <canvas id="teamActivityChart"></canvas>
        </div>
      </div>


      <!-- Resumen de Cuentas & Próximos Pasos (Ancho Completo) -->
      <div class="metric-card xl:col-span-2">
        <h2 class="section-title">Resumen de Cuentas & Próximos Pasos</h2>
        <p class="section-description">
          Lista de cuentas con una línea de resumen y un próximo paso sugerido.
        </p>
        <table>
          <tr>
            <th>Nombre de la Cuenta</th>
            <th>Responsable</th>
            <th>Resumen</th>
            <th>Próximo Paso</th>
          </tr>
          <tr v-for="(acc, idx) in accountSummary" :key="'acc-'+idx">
            <td>{{ acc.AccountName }}</td>
            <td>{{ acc.Owner }}</td>
            <td>{{ acc.Summary }}</td>
            <td>{{ acc.SuggestedNextStep }}</td>
          </tr>
        </table>
      </div>

    </div>
  </div>

  <script>
    const app = Vue.createApp({
      data() {
        return {
          // Initialize empty data structures
          hotTopics: [
            { Topic: "Precios", Mentions: 30 },
            { Topic: "Problemas Técnicos", Mentions: 25 },
            { Topic: "Características del Producto", Mentions: 20 },
            { Topic: "Facturación", Mentions: 18 },
            { Topic: "Implementación", Mentions: 12 },
            { Topic: "Soporte al Cliente", Mentions: 15 },
            { Topic: "Renovaciones", Mentions: 22 },
            { Topic: "Integraciones", Mentions: 16 },
            { Topic: "Capacitación", Mentions: 14 }
          ],
          teamData: [
            { Integrante: "Harriet Stone", PropuestasRealizadas: 5 },
            { Integrante: "James Robinson", PropuestasRealizadas: 8 },
            { Integrante: "Charlotte Pearson", PropuestasRealizadas: 2 },
            { Integrante: "Arthur Thompson", PropuestasRealizadas: 7 },
            { Integrante: "Lucy Johnson", PropuestasRealizadas: 4 },
            { Integrante: "Daniel Carter", PropuestasRealizadas: 0 },
            { Integrante: "Fiona Wood", PropuestasRealizadas: 9 },
            { Integrante: "George Cole", PropuestasRealizadas: 3 },
            { Integrante: "Emily Turner", PropuestasRealizadas: 1 },
            { Integrante: "William Bailey", PropuestasRealizadas: 6 }
          ],
          servicingDistribution: [
            { Label: "Servicio", Ammount: 120 },
            { Label: "Gestión Cuentas", Ammount: 80 },
          ],
          emailDistribution: {
            byUser: {
              labels: ["Harriet", "Lucy", "George", "James", "William"],
              servicingData: [25, 15, 10, 30, 40],
              mgmtData: [10, 20, 5, 8, 12]
            }
          },
          handlingTime: {
            byUser: {
              labels: [
                "Harriet Stone", "James Robinson", "Charlotte Pearson", "Arthur Thompson", "Lucy Johnson",
                "Daniel Carter", "Fiona Wood", "George Cole", "Emily Turner", "William Bailey"
              ],
              // Se está vendiendo NDC?
              ndcYesData: [3, 5, 2, 4, 6, 3, 1, 7, 1, 4],
              ndcNoData: [2, 2, 2, 2, 2, 2, 2, 2, 1, 2],

              // Se está vendiendo Cabina Premium Economy?
              premiumYesData: [6, 4, 8, 3, 5, 4, 3, 4, 7, 8],
              premiumNoData: [4, 6, 2, 7, 5, 6, 7, 6, 3, 2],

              // Se está vendiendo Corporate Bundle?
              corporateYesData: [4, 6, 3, 5, 7, 4, 2, 8, 2, 5],
              corporateNoData: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            }
          },
          accountSummary: [
            {
              AccountName: "Tesco",
              Owner: "Harriet Stone",
              Summary: "Requiere seguimiento tras la última conferencia",
              SuggestedNextStep: "Agendar demostración detallada"
            },
            {
              AccountName: "Aviva",
              Owner: "James Robinson",
              Summary: "Muestran interés en productos recientes",
              SuggestedNextStep: "Enviar propuesta completa"
            },
            {
              AccountName: "Rolls-Royce",
              Owner: "Charlotte Pearson",
              Summary: "Problema resuelto, en espera de respuesta",
              SuggestedNextStep: "Programar reunión de cierre"
            },
            {
              AccountName: "BBC",
              Owner: "Arthur Thompson",
              Summary: "Pendiente renovación de contrato",
              SuggestedNextStep: "Preparar documentos de renovación"
            },
            {
              AccountName: "Virgin Atlantic",
              Owner: "Lucy Johnson",
              Summary: "Sin actividad reciente",
              SuggestedNextStep: "Ofrecer nuevas tarifas promocionales"
            }
          ],
          activityVolume: {
            companies: [],
            data: []
          },
            userActivity: {
            labels: ["Harriet Stone", "James Robinson", "Charlotte Pearson", "Arthur Thompson", "Lucy Johnson", "Daniel Carter", "Fiona Wood", "George Cole", "Emily Turner", "William Bailey"],
            emailsData: [10, 12, 9, 15, 8, 4, 6, 12, 7, 10],
            meetingsData: [2, 4, 3, 5, 2, 1, 0, 3, 2, 4]
            },
          chartColors: {
            blue: "#0379E8",
            gray: "#E6E6E6",
          },
          chartOptions: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 16, color: "#CCC" }
              }
            }
          },
          isLoading: true,
          error: null
        };
      },
      mounted() {
        this.generateCharts();
      },
      methods: {
        generateCharts() {
        // Configuración general de escalas y colores
        const commonScales = {
          x: {
            stacked: false, 
            beginAtZero: true,
            ticks: {
              color: "#000000"
            }
          },
          y: {
            stacked: false,
            beginAtZero: true,
            ticks: {
              color: "#000000"
            }
          }
        };

        const colorBlue = "#0379E8";
        const colorGray = "#E6E6E6";
        
        // A) Distribución de Correos (Donut global: Servicio vs Gestión)

        new Chart(document.getElementById("servicingDistributionUserDonut"), {
          type: "doughnut",
          data: {
            labels: this.servicingDistribution.map(item => item.Label),
            datasets: [{
              data: this.servicingDistribution.map(item => item.Ammount),
              backgroundColor: [this.chartColors.blue, this.chartColors.gray]
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 16, color: "#000000" }
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const label = context.label || "";
                    const value = context.raw;
                    const total = this.servicingDistribution.reduce((sum, item) => sum + item.Ammount, 0);
                    const percent = ((value / total) * 100).toFixed(1) + "%";
                    return `${label}: ${value} (${percent})`;
                  }
                }
              }
            }
          }
        });


        // B) Distribución por Cuenta (Barras Apiladas)
        new Chart(document.getElementById("servicingDistributionUserBar"), {
          type: "bar",
          data: {
            labels: this.emailDistribution.byUser.labels,
            datasets: [
              { label: "Servicio", data: this.emailDistribution.byUser.servicingData, backgroundColor: colorBlue },
              { label: "Gestión", data: this.emailDistribution.byUser.mgmtData, backgroundColor: colorGray }
            ] 
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 16, color: "#000000" }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dsLabel = context.dataset.label || "";
                    const value = context.raw;
                    const i = context.dataIndex;
                    const sumForAccount = 
                      (this.emailDistribution.byUser.servicingData[i] || 0) + 
                      (this.emailDistribution.byUser.mgmtData[i] || 0);
                    const percent = sumForAccount > 0 ? ((value / sumForAccount) * 100).toFixed(1) + "%" : "0%";
                    return `${dsLabel}: ${value} (${percent})`;
                  }.bind(this)
                }
              }
            },
            scales: {
              ...commonScales,
              x: { ...commonScales.x, stacked: true },
              y: { ...commonScales.y, stacked: true }
            }
          }
        });


        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          layout: { padding: 0 },
          plugins: {
            legend: {
              position: "right",
              labels: { boxWidth: 16, color: "#000000" }
            }
          },
          scales: { ...commonScales }
        };

        // 1) Se está vendiendo NDC? (Gráfico de barras stacked por usuario con % de sí/no)
        const teamLabels = this.teamData.map(item => item.Integrante);

        const totalNDCResponses = this.handlingTime.byUser.ndcYesData.map((yes, index) => yes + this.handlingTime.byUser.ndcNoData[index]);
        const ndcYesPercentage = this.handlingTime.byUser.ndcYesData.map((yes, index) => (yes / totalNDCResponses[index]) * 100);
        const ndcNoPercentage = this.handlingTime.byUser.ndcNoData.map((no, index) => (no / totalNDCResponses[index]) * 100);

        new Chart(document.getElementById("handlingTimeTeamChart"), {
          type: "bar",
          data: {
            labels: this.handlingTime.byUser.labels,
            datasets: [
              { label: "% Sí", data: ndcYesPercentage, backgroundColor: colorBlue },
              { label: "% No", data: ndcNoPercentage, backgroundColor: colorGray  }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 16, color: "#000000" }
              }
            },
            scales: {
              x: { stacked: true, ticks: { color: "#000000" } },
              y: { stacked: true, beginAtZero: true, ticks: { color: "#000000", callback: value => `${value}%` } }
            }
          }
        });

        // 2) Se está vendiendo Cabina Premium Economy? (Gráfico de barras stacked por usuario con % de sí/no)
      
        const totalPremiumResponses = this.handlingTime.byUser.premiumYesData.map((yes, index) => yes + this.handlingTime.byUser.premiumNoData[index]);
        const premiumYesPercentage = this.handlingTime.byUser.premiumYesData.map((yes, index) => (yes / totalPremiumResponses[index]) * 100);
        const premiumNoPercentage = this.handlingTime.byUser.premiumNoData.map((no, index) => (no / totalPremiumResponses[index]) * 100);

        new Chart(document.getElementById("handlingTimeAccountChart"), {
          type: "bar",
          data: {
            labels: this.handlingTime.byUser.labels,
            datasets: [
              { label: "% Sí", data: premiumYesPercentage, backgroundColor: colorBlue },
              { label: "% No", data: premiumNoPercentage, backgroundColor: colorGray }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 16, color: "#000000" }
              }
            },
            scales: {
              x: { stacked: true, ticks: { color: "#000000" } },
              y: { stacked: true, beginAtZero: true, ticks: { color: "#000000", callback: value => `${value}%` } }
            }
          }
        });
         

        // 3) Se está vendiendo Corporate Bundle? (Gráfico de barras stacked por usuario con % de sí/no)
        const totalCorporateResponses = this.handlingTime.byUser.corporateYesData.map((yes, index) => yes + this.handlingTime.byUser.corporateNoData[index]);
        const corporateYesPercentage = this.handlingTime.byUser.corporateYesData.map((yes, index) => (yes / totalCorporateResponses[index]) * 100);
        const corporateNoPercentage = this.handlingTime.byUser.corporateNoData.map((no, index) => (no / totalCorporateResponses[index]) * 100);

        new Chart(document.getElementById("corporateBundleChart"), {
          type: "bar",
          data: {
            labels: this.handlingTime.byUser.labels,
            datasets: [
              { label: "% Sí", data: corporateYesPercentage, backgroundColor: colorBlue },
              { label: "% No", data: corporateNoPercentage, backgroundColor: colorGray }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
          position: "right",
          labels: { boxWidth: 16, color: "#000000" }
              }
            },
            scales: {
              x: { stacked: true, ticks: { color: "#000000" } },
              y: { stacked: true, beginAtZero: true, ticks: { color: "#000000", callback: value => `${value}%` } }
            }
          }
        });

        // 4) Actividad del Equipo (Reuniones + Correos)
        new Chart(document.getElementById("teamActivityChart"), {
          type: "bar",
          data: {
            labels: this.userActivity.labels,
            datasets: [
              { label: "Correos", data: this.userActivity.emailsData, backgroundColor: colorBlue },
              { label: "Reuniones", data: this.userActivity.meetingsData, backgroundColor: colorGray }
            ]
          },
          options: {
            ...chartOptions,
            scales: {
              ...commonScales,
              x: { ...commonScales.x, stacked: true },
              y: { ...commonScales.y, stacked: true }
            }
          }
        });

       

        // 6) Contestabilidad de Correos (Donut)
        const ctxEmailResp = document.getElementById("emailResponseChart");
        const responded = this.emailResponseStats.responded;
        const notResponded = this.emailResponseStats.notResponded;
        const totalEmails = responded + notResponded;
        new Chart(ctxEmailResp, {
          type: "doughnut",
          data: {
            labels: ["Respondidos", "Sin Respuesta"],
            datasets: [{
              data: [responded, notResponded],
              backgroundColor: [colorBlue, colorGray]
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 0 },
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 16, color: "#000000" }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || "";
                    const value = context.parsed;
                    const percent = ((value / totalEmails) * 100).toFixed(1) + "%";
                    return `${label}: ${value} (${percent})`;
                  }
                }
              }
            }
          }
        });
      }
    }});

    app.mount("#app");
  </script>
</body>
</html>
